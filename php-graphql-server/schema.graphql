# Custom scalars (implement or map to your GraphQL server's scalar libs)
scalar Date       # YYYY-MM-DD (maps to SQL DATE)
scalar Time       # HH:MM:SS (maps to SQL TIME)
scalar DateTime   # YYYY-MM-DDTHH:MM:SSZ (maps to SQL TIMESTAMP)
scalar JSON

# Basic types
type Organization {
    id: ID!
    orgName: String!            # maps to greenlight-orgs.orgName
    username: String!           # maps to greenlight-orgs.username
    bio: String                 # maps to greenlight-orgs.bio
    orgImg: String              # maps to greenlight-orgs.org_img
    createdAt: DateTime
    updatedAt: DateTime
    events(limit: Int, offset: Int, status: EventStatus, fromDate: Date, toDate: Date): [Event!]!
}

type User {
    id: ID!
    firstName: String
    lastName: String
    username: String!
    password: String!
    profileImg: String
    organizationId: ID!
    organization: Organization
    createdAt: DateTime
    updatedAt: DateTime
}

type Event {
    id: ID!
    organizationId: ID!        # maps to greenlight-events.organization_id
    organization: Organization # resolver may fetch organization by organizationId
    title: String!
    description: String
    eventDate: Date            # maps to greenlight-events.event_date
    setupTime: Time            # maps to greenlight-events.setup_time
    startTime: Time            # maps to greenlight-events.start_time
    endTime: Time              # maps to greenlight-events.end_time
    location: String
    eventImg: String
    eventStatus: EventStatus!       # maps to greenlight-events.event_status
    submittedAt: DateTime
    createdAt: DateTime
    updatedAt: DateTime
}

enum EventStatus {
    DRAFT
    REVIEW
    APPROVED
    PAST
    REJECTED
    CANCELLED
}

# Queries
type Query {
    # Organizations
    organization(id: ID!): Organization
    organizations(limit: Int = 25, offset: Int = 0, username: String): [Organization!]!

    # Events
    event(id: ID!): Event
    events(limit: Int = 25, offset: Int = 0, status: EventStatus, fromDate: Date, toDate: Date): [Event!]!

    # Events for a specific organization
    eventsByOrganization(orgId: ID!, limit: Int = 25, offset: Int = 0, status: EventStatus, fromDate: Date, toDate: Date): [Event!]!
    
    # Users (backed by greenlight-users table)
    user(id: ID!): User
    users(limit: Int = 25, offset: Int = 0, username: String): [User!]!
}

# Input types for mutations
input CreateOrganizationInput {
    orgName: String!
    username: String!
    password: String!    # server must hash before storing
    bio: String
}

input UpdateOrganizationInput {
    orgName: String
    username: String
    password: String     # server must hash before storing
    bio: String
}

input CreateEventInput {
    organizationId: ID!
    title: String!
    description: String
    eventDate: Date
    setupTime: Time
    startTime: Time
    endTime: Time
    location: String
    eventStatus: EventStatus = DRAFT
}

input UpdateEventInput {
    title: String
    description: String
    eventDate: Date
    setupTime: Time
    startTime: Time
    endTime: Time
    location: String
    eventStatus: EventStatus
}

input CreateUserInput {
    firstName: String
    lastName: String
    username: String!
    password: String!
    profileImg: String
    organizationId: ID!
}

input UpdateUserInput {
    firstName: String
    lastName: String
    profileImg: String
    username: String
    password: String
    organizationId: ID
}

# Mutations
type Mutation {
    # Organizations
    createOrganization(input: CreateOrganizationInput!): Organization!
    updateOrganization(id: ID!, input: UpdateOrganizationInput!): Organization!
    deleteOrganization(id: ID!): Boolean! # cascades to events if DB is configured with FK ON DELETE CASCADE

    # Events
    createEvent(input: CreateEventInput!): Event!
    updateEvent(id: ID!, input: UpdateEventInput!): Event!
    deleteEvent(id: ID!): Boolean!
    changeEventStatus(id: ID!, status: EventStatus!): Event!
    # Users
    createUser(input: CreateUserInput!): User!
    updateUser(id: ID!, input: UpdateUserInput!): User!
    deleteUser(id: ID!): Boolean!
}