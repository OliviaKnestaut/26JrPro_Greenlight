# Custom scalars (implement or map to your GraphQL server's scalar libs)
scalar Date       # YYYY-MM-DD (maps to SQL DATE)
scalar Time       # HH:MM:SS (maps to SQL TIME)
scalar DateTime   # YYYY-MM-DDTHH:MM:SSZ (maps to SQL TIMESTAMP)
scalar JSON

# Basic types
type Organization {
    id: ID!
    orgName: String!            # maps to greenlight-orgs.org_name
    username: String!           # maps to greenlight-orgs.username
    bio: String                 # maps to greenlight-orgs.bio
    orgImg: String              # maps to greenlight-orgs.org_img
    createdAt: DateTime
    updatedAt: DateTime
    events(limit: Int, offset: Int, status: EventStatus, fromDate: Date, toDate: Date): [Event!]!
}

type User {
    id: ID!
    firstName: String
    lastName: String
    username: String!
    password: String!
    profileImg: String
    role: String
    organization: Organization      # resolved via `greenlight-users.organization` (username)
    organizationUsername: String    # raw username stored in users.organization
    createdAt: DateTime
    updatedAt: DateTime
}

type Event {
    id: ID!
    organizationUsername: String!   # maps to greenlight-events.organization (stores org username)
    organization: Organization      # resolver may fetch organization by username
    createdBy: String               # maps to greenlight-events.created_by
    title: String!
    description: String
    eventDate: Date            # maps to greenlight-events.event_date
    setupTime: Time            # maps to greenlight-events.setup_time
    startTime: Time
    endTime: Time
    location: String
    locationType: LocationType
    eventLevel: Int
    eventImg: String
    eventStatus: EventStatus 
    formData: JSON
    submittedAt: DateTime
    createdAt: DateTime
    updatedAt: DateTime
}

type Purchase {
    id: ID!
    organizationUsername: String!
    organization: Organization
    dateSubmitted: DateTime!
    itemTitle: String!
    itemCategory: String!
    eventId: ID!
    orderStatus: String!
    itemCost: Float!
}

enum EventStatus {
    DRAFT
    REVIEW
    APPROVED
    REJECTED
    CANCELLED
}

enum LocationType {
    ON_CAMPUS
    OFF_CAMPUS
    VIRTUAL
}

# Queries
type Query {
    # Organizations
    organization(id: ID!): Organization
    organizations(limit: Int = 25, offset: Int = 0, username: String): [Organization!]!

    # Events
    event(id: ID!): Event
    events(limit: Int = 25, offset: Int = 0, status: EventStatus, fromDate: Date, toDate: Date): [Event!]!

    # Events for a specific organization
    eventsByOrganization(orgUsername: String!, limit: Int = 25, offset: Int = 0, status: String, fromDate: Date, toDate: Date): [Event!]!
    
    # Users (backed by greenlight-users table)
    user(id: ID!): User
    users(limit: Int = 25, offset: Int = 0, username: String): [User!]!

    # Purchases
    purchase(id: ID!): Purchase
    purchases(limit: Int = 25, offset: Int = 0): [Purchase!]!
    purchasesByOrganization(orgUsername: String!, limit: Int = 25, offset: Int = 0): [Purchase!]!
}

# Input types for mutations
input CreateOrganizationInput {
    orgName: String!
    username: String!
    bio: String
    orgImg: String
}

input UpdateOrganizationInput {
    orgName: String
    username: String
    bio: String
    orgImg: String
}

input CreateEventInput {
    organizationUsername: String!
    createdBy: String
    title: String!
    description: String
    eventDate: Date
    setupTime: Time
    startTime: Time
    endTime: Time
    location: String
    locationType: LocationType
    eventLevel: Int
    eventImg: String
    eventStatus: String
    formData: JSON
}

input UpdateEventInput {
    title: String
    description: String
    eventDate: Date
    setupTime: Time
    startTime: Time
    endTime: Time
    location: String
    locationType: LocationType
    eventLevel: Int
    eventImg: String
    eventStatus: String
    formData: JSON
}

input CreateUserInput {
    firstName: String
    lastName: String
    username: String!
    password: String!
    profileImg: String
    role: String
    organizationUsername: String!
}

input UpdateUserInput {
    firstName: String
    lastName: String
    profileImg: String
    username: String
    password: String
    role: String
    organizationUsername: String
}

input CreatePurchaseInput {
    organizationUsername: String!
    dateSubmitted: DateTime!
    itemTitle: String!
    itemCategory: String!
    eventId: ID!
    orderStatus: String!
    itemCost: Float!
}

input UpdatePurchaseInput {
    itemTitle: String
    itemCategory: String
    eventId: ID
    orderStatus: String
    itemCost: Float
}

# Mutations
type Mutation {
    # Organizations
    createOrganization(input: CreateOrganizationInput!): Organization!
    updateOrganization(id: ID!, input: UpdateOrganizationInput!): Organization!
    deleteOrganization(id: ID!): Boolean! # cascades to events if DB is configured with FK ON DELETE CASCADE

    # Events
    createEvent(input: CreateEventInput!): Event!
    updateEvent(id: ID!, input: UpdateEventInput!): Event!
    deleteEvent(id: ID!): Boolean!
    changeEventStatus(id: ID!, status: EventStatus!): Event!
    # Users
    createUser(input: CreateUserInput!): User!
    updateUser(id: ID!, input: UpdateUserInput!): User!
    deleteUser(id: ID!): Boolean!
    # Purchases
    createPurchase(input: CreatePurchaseInput!): Purchase!
    updatePurchase(id: ID!, input: UpdatePurchaseInput!): Purchase!
    deletePurchase(id: ID!): Boolean!
}